## 7.1 크롬 개발자 도구란?

### 크롬 개발자 도구
- 크롬에서 제공하는 개발자용 도구
- `시크릿 모드`에서 페이지와 개발자 도구 여는 것을 권장함

## 7.2 요소 탭
### 7.2.1 요소 화면
- 현재 HTML뿐만 아니라, 직접 코드 수정해서 웹 페이지에서 어떻게 보이는지도 확인 가능
- 요소 중단점을 활용해 디버깅 가능

### 7.2.2 요소 정보
- 요소와 관련된 정보(`스타일`, `계산됨`, `레이아웃`, `이벤트 리스너`, `DOM 중단점`, `속성`, `접근성`)

## 7.3 소스 탭
- 웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일 확인 가능
- 소스 중단점을 생성해 디버깅 가능

### 제공 정보
1. `감시`
   - 감시하고 싶은 변수 선언하고, 해당 변수 정보 확인 가능
   - 디버깅 시점에서 특정 변수 값 알고 싶을 때 활용
  
2. `중단점`
   - 현재 웹 사이트에서 추가한 중단점
  
3. `범위`
   - 현재 중단점에서의 스코프
  
4. `호출 스택`
   - 현재 중단점의 콜스택
  
5. `전역 리스너`
   - 현재 전역 스코프에서 추가된 리스너 목록
  
6. `XHR/가져오기`, `DOM`, `이벤트 리스너`, `CSR 위반 중단점`
   - 기타 중단점들...
  

## 7.4 네트워크 탭
- 해당 웹 페이지를 접속한 순간부터 발생하는 모든 네트워크 관련 작동이 기록됨
- 상단 : `Fetch/XHR`, `CSS`, `JS` 등 네트워크 요청 종류 필터링 가능
- 중간 : 실제 해당 페이지를 불러오는 과정에서 발생한 네트워크 요청
- 하단 : 페이지를 불러오는 기간 동안 발생한 총 요청 건수와 총 다운로드한 업로드 리소스 크기

### 네트워크 탭을 통해 집중적으로 확인해 봐야 하는 점
- 불필요한 요청 또는 중복되는 요청은 없는지
- 웹페이지 구성에 필요한 리소스 크기가 너무 크지 않은지
- 리소스를 불러오는 속도는 적절한지, 너무 속도가 오래 걸리는 리소스는 없는지
- 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어가는지

## 7.5 메모리 탭
- 현재 웹 페이지가 차지하고 있는 메모리 관련 정보

### 7.5.1 자바스크립트 인스턴스 VM 선택
- 현재 실행 중인 자바스크립트 VM 인스턴스에서 개발자가 디버깅 하고 싶은 환경 선택

### 7.5.2 힙 스냅샷
> 현재 페이지의 메모리 상태를 확인해 볼 수 있는 메모리 프로파일 도구

```typescript
const DUMMY_LIST = []

export default function App() {
	function handleClick() {
		Array.from({ length: 10_000_000 }).forEach((_, idx) =>
			DUMMY_LIST.push(Math.random() * idx),
		)
		alert('complete!')
	}
	
	return <button onClick={handleClick}>BUG</button>
}
```
↑ 스냅샷 테스트를 위한 잘못된 코드

**스냅샷 활용 방법**
1. 페이지 로드 후 스냅샷 촬영
2. 버그를 확인하고 싶은 동작 실행
3. 스냅샷 재촬영
4. `스냅샷 1에서 스냅샷 2 사이에 할당된 객체`를 클릭해서 확인하자!!

**얕은 크기와 유지된 크기의 차이점**
- `얕은 크기` : 객체 자체가 보유하는 메모리 바이트 크기
- `유지된 크기` : 해당 객체 자체뿐만 아니라, 다른 부모가 존재하지 않은 모든 자식 객체들의 크기까지 더한 값
=> 메모리 누수를 찾을 때, **얕은 크기는 작으나 유지된 크기가 큰 객체를 찾아야 한다!**

### 7.5.3 타임라인 할당 계측
> 시간의 흐름에 따라 메모리 변화를 확인할 수 있는 기능
- 시간의 흐름에 따른 메모리 변화를 비롯해, 메모리 변화를 일으킨 변수가 무엇인지, 해당 변수가 어느 정도 크기를 차지하고 있는지 등 확인 가능

### 7.5.4 할당 샘플링

**타임라인 할당 계측과의 공통점과 차이점**
- 공통점 : 시간의 흐름에 따라 발생하는 메모리 점유 확인 가능
- 차이점 : 자바스크립트 실행 스택별로 분석이 가능하고, 이 분석을 "함수" 단위로 한다는 차이점이 있음

- 프로파일링을 할 때 브라우저에 주는 부담을 최소화할 수 있다
- 메모리 누수가 짐작되지만 정확히 어디서 발생하는지 몰라서 힙 스냅샷을 촬영해 비교하기 어려운 경우, 오랜 기간 메모리 누수가 의심되어 프로파일링을 장기간 수행해야 하는 경우 등등에 좋음

## 7.6 Next.js 환경 디버깅하기

### 7.6.1 Next.js 프로젝트를 디버그 모드로 실행하기

```json
"dev": NODE_OPTIONS='--inspect' next dev
```

디버거 활성화

### 7.6.2 Next.js 서버에 트래픽 유입시키기
- 서버에 직접 트래픽을 발생시켜 확인하는 게 제일 확실한 방법
- 오픈소스 웹서버 성능 검사 도구인 `ab`를 사용하자!

```shell
ab -k -c 50 -n 10000 "http://127.0.0.1:3000/"
```

- 한 번에 50개의 요청을 총 10,000번 시도하는 명령어
- 단순히 요청 수행하는 것뿐만 아닌, 요청으로부터 응답받는 데 걸린 시간, 바이트 크기 등 다양한 정보 확인 가능

### 7.6.3 Next.js의 메모리 누수 지점 확인하기

```typescript
import type { GetServerSidePropsContext, NextPage } from 'next'

const access_users = []

function Home({ currentDateTime }: { currentDateTime: number }) {
	return <>{currentDateTime}</>
}

export const getServerSideProps = (ctx: GetServerSidePropsContext) => {
	const currentDateTime = new Date().getTime()
	
	access_users.push({
		user: `user-${Math.round(Math.random() * 100000)}`,
		currentDateTime,
	})
	
	return {
		props: {
			currentDateTime,
		},
	}
}

export default Home
```

- `getServerSideProps`가 실행될 때마다 전역 변수로 선언된 `access_users`에 끊임없이 push 수행
- `getServerSideProps`의 다수 실행과 메모리 누수를 확인할 수 있다!
